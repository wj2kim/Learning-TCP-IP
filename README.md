# Learning-TCP-IP
TCP/IP 에 관하여 


# TCP/IP 란

연결지향이며, 자체적으로 오류를 처리하며, 네트워크 전송 중 순서가 뒤바뀐 메시지를 교정시켜주는 기능을 가지고 있다. 연결 지향적이란 말은 데이터를 전송하는 측과 데이터를 전송받는 측에서 전용의 데이터 전송 선로를 만든다는 의미이다. ( session, socket 같은). 데이터의 신회도가 중요하다고 판단 될때 주로 사용된

TCP/IP 가 나타난 이유 → 컴퓨터간 통신을 위해서. 

컴퓨터와 컴퓨터간의 지역네트워크 (LAN) 혹은 광역네트워크 (WAN)에서 원할한 통신을 가능하도록 하기위한 통신규약(Protocol) 으로 정의 할 수 있다. ( 최초 미국방성에서 구축한 ARPANET 에서 시작됨 ) 

TCP/IP 는 www, email, telnet, FTP 등 대부분이 TCP/IP 기반에서 만들어져있다. 

인터넷으로 연결된 수많은 컴퓨터와 통신을 위해서  TCP/IP를 선택한 이유는 그 개방성에 있다. 

→ 하드웨어, 운영체제, 접속매체에 관계없이 동작할 수 있다는 장점이 있다. 이것이 TCP/IP 가 인터넷 통신을 위한 핵심으로 선택된 큰 요인이였다. 

TCP/IP는 TCP와 IP의 2개의 프로토콜로 이루어져 있는데, 통상 IP 프로토콜 위에 TCP 프로토콜이 놓이게 되이므로 TCP/IP 라고 부르게 되었다. 

### IP 란

node(단말기)와 node - 이해하기 쉽게 컴퓨터와 컴퓨터 - 간의 데이터 패킷을 전송하기 위해서는 각 node 에 주소를 필요로 함. 4바이트로 이루어진 주소 번호를 사용하여 각각의 node를 구분하고 목적지를 찾아가게 된다. 우리는 이를 IP Address 하고 한다. 예: 192.168.100.100. 

IP는 Internet Protocol 의 줄임말이다. 숫자로  식별하기 까다롭기 때무넹 Domain 네임으로 변환 시켜주는 Domain Name 서비스를 이용한다. 

### TCP 란

서버와 클라이언트간에 데이터를 신회성있게 전달하기 위해 만들어진 프로토콜이다. 데이터는 네티워크 선로를 통해 전달되는 과정에서 손실되거나 순서가 뒤바뀌어서 전달 될 수있는데, TCP는 손실을 검색해내서, 이를 교정하고 재조합 할 수 있도록 해준다. 

TCP 는 Transmission Control Protocol 의 줄임말이다. 

데이터를 전송하기 전에 데이터 전송을 위한 연결을 만드는 연결지향 프로토콜이다. 

### TCP 의 핵심 기능

1. 패킷이 빠졌을 경우, 재전송을 요청하는 기능 
2. 패킷에 일련번호를 줌으로써 , 서로 다르게 도착될지도 모르는 패킷의 순서를 재조합하는 기능

# UDP 와 TCP

TCP 외에 UDP 라는 프로토콜도 존재란다. 

UDP는 User Datagram Protocol의 줄임말이다.

UDP는 비연결지향이며, 오류를 처리하거나 순서를 재좁하시켜주는 기능을 가지고 있지 않다. 단순히 데이터를 받거나, 전져주기만 하는 프로토콜이다. UDP는 특히 실시간 멀티미디어 정보를 처리하기 위해서 주로 사용한다. 

TCP를 실시간 멀티미디어 정보를 처리하는데 사용할 경우 TCP의 오류정정 특성상 메시지가 도착하지 않거나 할 경우 다음 메시지를 받지 않고, 메시지 재전송을 요구하므로, 실시간으로 전송하기에는 적당하지 않다. 반면 UDP를 사용하면 중간에 패킷이 소실되더라도 개의치 않고 다음 패킷을 받아들이므로 실시간 메시지 처리가 가능하다. 

물론 데이터 손실로 인해서 멀티미디어 데이터의 질이 떨어질 수 도 있으나, 화질이나 음질에 약간 손상이 있더라도 계속적으로 서비스가 되는게 훨씬 더 유리할 것이다. 전화를 하는데, 약간의 잡음이 섞인다고 해서, 잡음을 정정하기 위해서 서로 통화를 못하는 사태가 발생하는 안되는것과 같은 이치이다. 

# TCP/IP 를 이용한 컴퓨터간 데이터 통신

그렇다면, 각 컴퓨터간을 연결해주는 이더넷 카드를 통해서 어떻게 TCP/IP 메시지가 전달되는 것일까? 

이것을 이해하기 위해서는 OSI7에 대한 이해가 필요하다. OSI는 각종 시스템간의 연결을 위해서 ISO 에서 제안한 모델로써, 시스템에 상관없이 서로의 시스템이 연결될 수 있도록 만들어주는 모델이다. 

### OSI 7 계층

OSI는 Open System Interconnection Reference Model 의 줄임말이다.

OSI는 아래와 같이 7개의 계층으로 되어 있다.

 7. Application Layer

 6. Presentation Layer

 5. Session Layer

 4. Transport Layer

 3. Network Layer

 2. Data Link Layer

1. Physical Layer

컴퓨터와 컴퓨터사이의 데이터 전송을 위해서는 위의 7개의 계층을 직-간접적으로 거쳐서 전송이 되게 된다. 

7개의 계층으로 나눈 이유 → 각 계층에 대한 캡슐화와 은닉이 가능하기 때문 

서비스 개발자는 Application Layer 와 Presentation Layer 만 신경 쓰면 된다. 실제 어플리케이션 개발자는 Session Layer 와 Transport Layer 정도만 신경쓰면 될것이다. NetworkLayer 계층 아래는 운영체지가 알아서 챙겨주므로 거의 신경쓸 필요가 없다. 마찬가지로 하드웨어를 만드는 사람은 physical Layer 만 신경쓰면 되며, 그 위의 계층에 대해서는 신경 쓸 필요가 없다. ( 다 신경 써야 하는 개발자도 물론 존재한다 ) 

OSI 를 이렇게 계층별로 나눔으로써, 각 계층에서 필요한 부분만을 개발자들이 신경쓰게 되고 통신 서비스 개발시간을 줄일 수 있도록 도와준다. 

### TCP/IP 4계층

 4. Application Layer 

 3. Transport Layer

 2. Internet Layer 

 1. Physical Layer

Application Layer  → 네트워크를 사용하는 응용프로그램 (FTP, Telnet, SMTP) 등으로 이루어지며, OSI 계층의 Application Layer 와 Presentation Layer를 모두 포함한다. 

Transport Layer → 도착을 원하는 시스템까지 데이터를 전송하기 위한 일을 하는 계층이다. OSI 모델의 Session Layer 과 Transport Layer  를 포함하고 있으며, 각각의 시스템을 연결하고, TCP 프로토콜을 이용하여 데이터를 전송한다. 

Internet Layer → 데이터를 정의하고 데이터의 경로를 배정하는 일 (라우터)를 담당한다. 데이터를 정확히 라우팅 하기 위해서 IP 프로토콜을 사용한다. OSI의 Network Layer 과 Data Link Layer 를 포함한다. 

Physical Layer → 물리적 게층 즉 이더넷 카드와 같은 하드웨어를 말한다. 

### TCP/IP 4계층에 의한 데이터 전송

현재 가장 많 사용하는 인터넷 서비스중 하나인 www를 예를 들어 그림을 그려 보았다. 

www는 HTTP ( HyperText Transport Protocol ) 이라는 프로토콜을 이용한다. 

1. 사용자는 IE 나 Chrome 같은 브라우저를 사용하여 [www.naver.com](http://www.naver.com) 같은 URL 입력을 통해서 웹 페이지를 요청한다. 
2. 사용자의 요청 ( 문자 메시지가 될것이다 )은 인터넷상에서 전달되기 용이한 패킷으로 만들기 위해서 TCP 패킷으로 만들어지게 된다.
3. 이것은 다시 인터넷 상에서 원하는 주소로 이동할 수 있도록하기 위해 IP 패킷으로 다시 만들어 지고 ( IP 패킷에는 자신의 주소와, 도착해야될 상대방의 주소정보가 들어있을것이다) 
4. 이더넷 카드로 보내어져서 Internet 으로 나가게 된다. 
5. Internet 상에는 원하는 주소로 TCP/IP 패킷을 보내기 위한 여러가지 장치들이 존재하는데 (라우터, 토큰링 같은), 이들 장치를 통해서 [www.naver.com](http://www.naver.com) 의 이더넷 카드로 TCP/IP 패킷이 전달되게 된다. 
6. 이더넷 카드는 TCP/IP 패킷을 바로 윗 계층인 Internet Layer 로 보내는데, 여기에서는 IP 패킷을 분석해서, 이 패킷이 어디서 왔으며, 그 도착지가 어디인지를 판단하게 된다. ( IP 주소 기반으로 판단한다. ) 
7. 목적지가 자신이라면 이것을 다시 Transport Layer 로 보내고, TCP 프로토콜을 사용하여, 누락된게 있으면 다시 요청하고 순서를 재조합하는 등 통신 메시지를 검사해서 이것을 다시 Appliication Layer 엣게 보낸다. 
8. Application Layer 에서는 웹서버 (IIS, Apache 같은) 통신 메시지를 HTTP 프로토콜에 준하여, 감사를 하여서 사용자가 요청한 웹페이지를 읽어 들여서 Transport 계층으로 보낸다. 
9. 웹 페이지를 브라우저 까지 전송하는 과정은 위의 정 반대의 과정을 순차적으로 거치게 된다. 
10. 최종적으로 웹브라우저는 웹페이지를 받아서 HTTP 프로토콜에 준하여, 렌더링 작업을 거친 후 화면에 뿌려준다. 

앞의 설명을 잘 읽어 보면 각각의 계층은 각각의 계층만을 상관하고 있음을 알 수 있다. 즉 Application Layer에 위치하는 브라우저와 webserver 는 HTTP 프로토콜에 의해서 자신의 계층끼리만 통신하고, Transport Layer 역시 TCP 프로토콜에 의해서 Transport Layer 끼리 통신을 함을 알 수 있다. 말 그대로 계층적 구조를 가지며, 각 계층은 대응되는 상대편의 계층에 대해서만 상관한다. 

# TCP/IP 통신의 흐름

TCP/IP로 통신을 할 때 계층 순서를 거쳐 상대와 통신을 한다. 송신하는 측은 애플리케이션 계층에서 부터 내려가고, 수신하는 측은 애플리케이션 계층으로 올라간다. 

HTTP를 예로 들면 먼저 송신측 클라이언트의 애플리케이션 계층(HTTP)에서 어느 웹 페이지를 보고 싶다는 HTTP 리퀘스트를 지시한다. 그 다음에 있는 트랜스포트 계층(TCP)에서는 애플리케이션 계층에서 받은 데이터(HTTP 메시지)를 통신하기 쉽게 조각내어 안내 번호와 포트 번호를 붙여 네트워크 계층에 전달 한다.

네트워크 계층(IP)에서는 수신지 MAC 주소를 추가해서 링크 계층에 전달한다. 이로써 네트워크를 통해 송신할 준비가 된것이다.

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9f37cf3a-9e6f-4749-8a94-2a8798ab7d91/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9f37cf3a-9e6f-4749-8a94-2a8798ab7d91/Untitled.png)

각 계층을 거칠 때는 반드시 헤더로 불려지는 해당 계층마다 해당 계층에 필요한 정보를 추가한다. 반대로 수신측에서는 각 계층을 거칠 때마다 반드시 해당 계층마다 사용한 헤더를 삭제한다. 이렇게 정보를 감싸는것을 캡슐화라고 부른다.

# 연결지향이란?

TCP는 UDP와 달리 연결지향이라고 배웠다. 위의 과정에서 TCP/IP 에 의해서 데이터가 어떻게 전송되어 지는지를 알아봤는데, 데이터가 전송되지 전에, browser 과 server 간의 연결을 성립하는 과정이 데이터를 전송하는 과정 전에 이루어 지게 된다.  ( 데이터를 보내기전 서로가 연결되고 서로를 확인하는 작업 )

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/940aa145-536d-475e-a6bc-f9e8c56a6edd/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/940aa145-536d-475e-a6bc-f9e8c56a6edd/Untitled.png)

즉 데이터가 전송 되기 전에, browser 는 server 에게 SYN seq=x (서버 잘 있습니까?) 이라는 메시지를 보내고 server 는 다시 browser 에게 SYN seq=y, ACK x+1 ( 저는 준비 되어있으니, 데이터를 보내세요) 라는 메시지를 보내고 browser 는 다시 서버에게 ACK y+1 (네, 그럼 지금부터 데이터를 보내겠습니다) 라고 메시지를 보낸다. 그렇게 서로의 존재를 확인하는 절차를 수행한 후 정식 데이터를 교환하기 위한 통신 선로를 개설하게 된다. 통신선로를 하나 만들기 위해서는 3번의 데이터 전송이 일어나게 되므로, 이것을 three way handshake 라고 한다. 

이렇게 연결이 이루어지면 모든 정식 데이터는 연결된 통신 선로를 통해서 교환하게 되며, 이러한 이유로 TCP를 "연결 지향" 프로토콜이라고 부르는 것이다. UDP는 이러한 과정없이 단순히 데이터만을 전송함으로 "데이터그램" 프로토콜이라고 부른다.

왜 연결지향을 선택했나? → 연속적인 데이터 전송의 신회성을 위해서

# 데이터 단위

## 1. 비트 (bit)

컴퓨터는 단순히 데이터를 저장할 때 메모리와 이를 처리하는 연산장치 그리고 입출력 장치로 구성되어 있다.

2진수 한자리는 두가지 상태의 정보를 표현 가능하다. ( 1 과 0 ) 

### 8비트

1개의 비트는 단순히 2가지 상태만을 저장할 수 있기에 정보 저장에 있어서 매우 단편적이다. 

하지만 두자리 비트를 쓰면 4가지의 정보를 표현 할 수 있다. 그리고 컴퓨터는 보통 8개의 비트를 모아서 8비트를 자주 사용한다. 8비트는 0 에서 255개의 상태를 표현 할 수 있다. 

1바이트는 한개의 문자를 표현 할 수 있다. ( *영어권만, 정확히 말하면 7 비트만으로 표현이 가능하다. 0 ~ 127 개의 정보 표현으로 특수 문자 및 알파벳을 표현하고도 남는다 )

동양권의 문자를 표현 하기 위해서는 한 문자당 2바이트가 사용된다. 

## 2. 바이트 (byte)

8 비트를 1바이트라고 한다. 또 한 1 캐릭터 ( charactor ) 라고도 한다.
